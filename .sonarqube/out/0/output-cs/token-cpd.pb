≠2
a/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Controllers/CartController.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )
Controllers) 4
;4 5
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public		 
class		 
CartController		 
:		 

Controller		 (
{

 
private 
readonly 
ICartRepository $
_cartRepository% 4
;4 5
	protected 
ResponseDto 
	_response #
;# $
public 

CartController 
( 
ICartRepository )
cartRepository* 8
)8 9
{ 
_cartRepository 
= 
cartRepository (
;( )
this 
. 
	_response 
= 
new 
ResponseDto (
(( )
)) *
;* +
} 
[ 
HttpGet 
( 
$str 
)  
]  !
public 

async 
Task 
< 
object 
> 
GetCart %
(% &
string& ,
userId- 3
)3 4
{ 
try 
{ 	
CartDto 
cartDto 
= 
await #
_cartRepository$ 3
.3 4
GetCartByUserId4 C
(C D
userIdD J
)J K
;K L
	_response 
. 
Result 
= 
cartDto &
;& '
} 	
catch 
( 
	Exception 
e 
) 
{   	
	_response!! 
.!! 
	IsSuccess!! 
=!!  !
false!!" '
;!!' (
	_response"" 
."" 
ErrorMessages"" #
=""$ %
new""& )
List""* .
<"". /
string""/ 5
>""5 6
(""6 7
)""7 8
{""9 :
e""; <
.""< =
ToString""= E
(""E F
)""F G
}""H I
;""I J
}## 	
return$$ 
	_response$$ 
;$$ 
}%% 
['' 
HttpPost'' 
('' 
$str'' 
)'' 
]'' 
public(( 

async(( 
Task(( 
<(( 
object(( 
>(( 
AddCart(( %
(((% &
CartDto((& -
cartDto((. 5
)((5 6
{)) 
try** 
{++ 	
CartDto,, 
cartDt,, 
=,, 
await,, "
_cartRepository,,# 2
.,,2 3
CreateUpdateCart,,3 C
(,,C D
cartDto,,D K
),,K L
;,,L M
	_response-- 
.-- 
Result-- 
=-- 
cartDt-- %
;--% &
}// 	
catch00 
(00 
	Exception00 
e00 
)00 
{11 	
	_response22 
.22 
	IsSuccess22 
=22  !
false22" '
;22' (
	_response33 
.33 
ErrorMessages33 #
=33$ %
new33& )
List33* .
<33. /
string33/ 5
>335 6
(336 7
)337 8
{339 :
e33; <
.33< =
ToString33= E
(33E F
)33F G
}33H I
;33I J
}44 	
return55 
	_response55 
;55 
}66 
[88 
HttpPost88 
(88 
$str88 
)88 
]88 
public99 

async99 
Task99 
<99 
object99 
>99 

UpdateCart99 (
(99( )
CartDto99) 0
cartDto991 8
)998 9
{:: 
try;; 
{<< 	
CartDto== 
cartDt== 
=== 
await== "
_cartRepository==# 2
.==2 3
CreateUpdateCart==3 C
(==C D
cartDto==D K
)==K L
;==L M
	_response>> 
.>> 
Result>> 
=>> 
cartDt>> %
;>>% &
}@@ 	
catchAA 
(AA 
	ExceptionAA 
eAA 
)AA 
{BB 	
	_responseCC 
.CC 
	IsSuccessCC 
=CC  !
falseCC" '
;CC' (
	_responseDD 
.DD 
ErrorMessagesDD #
=DD$ %
newDD& )
ListDD* .
<DD. /
stringDD/ 5
>DD5 6
(DD6 7
)DD7 8
{DD9 :
eDD; <
.DD< =
ToStringDD= E
(DDE F
)DDF G
}DDH I
;DDI J
}EE 	
returnFF 
	_responseFF 
;FF 
}GG 
[II 
HttpPostII 
(II 
$strII 
)II 
]II 
publicJJ 

asyncJJ 
TaskJJ 
<JJ 
objectJJ 
>JJ 

RemoveCartJJ (
(JJ( )
[JJ) *
FromBodyJJ* 2
]JJ2 3
intJJ3 6
cartIdJJ7 =
)JJ= >
{KK 
tryLL 
{MM 	
boolNN 
	issuccessNN 
=NN 
awaitNN "
_cartRepositoryNN# 2
.NN2 3
RemoveFromCartNN3 A
(NNA B
cartIdNNB H
)NNH I
;NNI J
	_responseOO 
.OO 
ResultOO 
=OO 
	issuccessOO (
;OO( )
}QQ 	
catchRR 
(RR 
	ExceptionRR 
eRR 
)RR 
{SS 	
	_responseTT 
.TT 
	IsSuccessTT 
=TT  !
falseTT" '
;TT' (
	_responseUU 
.UU 
ErrorMessagesUU #
=UU$ %
newUU& )
ListUU* .
<UU. /
stringUU/ 5
>UU5 6
(UU6 7
)UU7 8
{UU9 :
eUU; <
.UU< =
ToStringUU= E
(UUE F
)UUF G
}UUH I
;UUI J
}VV 	
returnWW 
	_responseWW 
;WW 
}XX 
}YY Œ

f/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/DbContexts/ApplicationDbContext.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )

DbContexts) 3
;3 4
public 
class  
ApplicationDbContext !
:! "
	DbContext# ,
{ 
public 
 
ApplicationDbContext 
(  
DbContextOptions  0
<0 1 
ApplicationDbContext1 E
>E F
optionsG N
)N O
:P Q
baseR V
(V W
optionsW ^
)^ _
{		 
} 
public 

DbSet 
< 
Product 
> 
Products "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

DbSet 
< 

CartHeader 
> 
CartHeaders (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 

DbSet 
< 
CartDetails 
> 
CartDetails )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
} ñ
T/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/MappingConfig.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
;( )
public 
class 
MappingConfig 
{ 
public		 

static		 
MapperConfiguration		 %
RegisterMap		& 1
(		1 2
)		2 3
{

 
var 
mappingConfig 
= 
new 
MapperConfiguration  3
(3 4
config4 :
=>; =
{ 	
config 
. 
	CreateMap 
< 

ProductDto '
,' (
Product) 0
>0 1
(1 2
)2 3
.3 4

ReverseMap4 >
(> ?
)? @
;@ A
config 
. 
	CreateMap 
< 
CartHeaderDto *
,* +

CartHeader, 6
>6 7
(7 8
)8 9
.9 :

ReverseMap: D
(D E
)E F
;F G
config 
. 
	CreateMap 
< 
CartDetailsDto +
,+ ,
CartDetails- 8
>8 9
(9 :
): ;
.; <

ReverseMap< F
(F G
)G H
;H I
config 
. 
	CreateMap 
< 
CartDto $
,$ %

CartHeader& 0
>0 1
(1 2
)2 3
.3 4

ReverseMap4 >
(> ?
)? @
;@ A
} 	
)	 

;
 
return 
mappingConfig 
; 
} 
} ÚG
x/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Migrations/20220118123046_AddProductAndCartModels.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )

Migrations) 3
{ 
public 

partial 
class #
AddProductAndCartModels 0
:1 2
	Migration3 <
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
CartHeaderId  
=! "
table# (
.( )
Column) /
</ 0
int0 3
>3 4
(4 5
type5 9
:9 :
$str; @
,@ A
nullableB J
:J K
falseL Q
)Q R
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
UserId 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 G
,G H
nullableI Q
:Q R
trueS W
)W X
,X Y

CouponCode 
=  
table! &
.& '
Column' -
<- .
string. 4
>4 5
(5 6
type6 :
:: ;
$str< K
,K L
nullableM U
:U V
trueW [
)[ \
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
CartHeaderId> J
)J K
;K L
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str  
,  !
columns 
: 
table 
=> !
new" %
{ 
	ProductId 
= 
table  %
.% &
Column& ,
<, -
int- 0
>0 1
(1 2
type2 6
:6 7
$str8 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
falseQ V
)V W
,W X
Price 
= 
table !
.! "
Column" (
<( )
double) /
>/ 0
(0 1
type1 5
:5 6
$str7 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
Description   
=    !
table  " '
.  ' (
Column  ( .
<  . /
string  / 5
>  5 6
(  6 7
type  7 ;
:  ; <
$str  = L
,  L M
nullable  N V
:  V W
true  X \
)  \ ]
,  ] ^
CategoryName!!  
=!!! "
table!!# (
.!!( )
Column!!) /
<!!/ 0
string!!0 6
>!!6 7
(!!7 8
type!!8 <
:!!< =
$str!!> M
,!!M N
nullable!!O W
:!!W X
true!!Y ]
)!!] ^
,!!^ _
ImageUrl"" 
="" 
table"" $
.""$ %
Column""% +
<""+ ,
string"", 2
>""2 3
(""3 4
type""4 8
:""8 9
$str"": I
,""I J
nullable""K S
:""S T
true""U Y
)""Y Z
}## 
,## 
constraints$$ 
:$$ 
table$$ "
=>$$# %
{%% 
table&& 
.&& 

PrimaryKey&& $
(&&$ %
$str&&% 2
,&&2 3
x&&4 5
=>&&6 8
x&&9 :
.&&: ;
	ProductId&&; D
)&&D E
;&&E F
}'' 
)'' 
;'' 
migrationBuilder)) 
.)) 
CreateTable)) (
())( )
name** 
:** 
$str** #
,**# $
columns++ 
:++ 
table++ 
=>++ !
new++" %
{,, 
CartDetailsId-- !
=--" #
table--$ )
.--) *
Column--* 0
<--0 1
int--1 4
>--4 5
(--5 6
type--6 :
:--: ;
$str--< A
,--A B
nullable--C K
:--K L
false--M R
)--R S
... 

Annotation.. #
(..# $
$str..$ 8
,..8 9
$str..: @
)..@ A
,..A B
CartHeaderId//  
=//! "
table//# (
.//( )
Column//) /
</// 0
int//0 3
>//3 4
(//4 5
type//5 9
://9 :
$str//; @
,//@ A
nullable//B J
://J K
false//L Q
)//Q R
,//R S
	ProductId00 
=00 
table00  %
.00% &
Column00& ,
<00, -
int00- 0
>000 1
(001 2
type002 6
:006 7
$str008 =
,00= >
nullable00? G
:00G H
false00I N
)00N O
,00O P
Count11 
=11 
table11 !
.11! "
Column11" (
<11( )
int11) ,
>11, -
(11- .
type11. 2
:112 3
$str114 9
,119 :
nullable11; C
:11C D
false11E J
)11J K
}22 
,22 
constraints33 
:33 
table33 "
=>33# %
{44 
table55 
.55 

PrimaryKey55 $
(55$ %
$str55% 5
,555 6
x557 8
=>559 ;
x55< =
.55= >
CartDetailsId55> K
)55K L
;55L M
table66 
.66 

ForeignKey66 $
(66$ %
name77 
:77 
$str77 G
,77G H
column88 
:88 
x88  !
=>88" $
x88% &
.88& '
CartHeaderId88' 3
,883 4
principalTable99 &
:99& '
$str99( 5
,995 6
principalColumn:: '
:::' (
$str::) 7
,::7 8
onDelete;;  
:;;  !
ReferentialAction;;" 3
.;;3 4
Cascade;;4 ;
);;; <
;;;< =
table<< 
.<< 

ForeignKey<< $
(<<$ %
name== 
:== 
$str== A
,==A B
column>> 
:>> 
x>>  !
=>>>" $
x>>% &
.>>& '
	ProductId>>' 0
,>>0 1
principalTable?? &
:??& '
$str??( 2
,??2 3
principalColumn@@ '
:@@' (
$str@@) 4
,@@4 5
onDeleteAA  
:AA  !
ReferentialActionAA" 3
.AA3 4
CascadeAA4 ;
)AA; <
;AA< =
}BB 
)BB 
;BB 
migrationBuilderDD 
.DD 
CreateIndexDD (
(DD( )
nameEE 
:EE 
$strEE 3
,EE3 4
tableFF 
:FF 
$strFF $
,FF$ %
columnGG 
:GG 
$strGG &
)GG& '
;GG' (
migrationBuilderII 
.II 
CreateIndexII (
(II( )
nameJJ 
:JJ 
$strJJ 0
,JJ0 1
tableKK 
:KK 
$strKK $
,KK$ %
columnLL 
:LL 
$strLL #
)LL# $
;LL$ %
}MM 	
	protectedOO 
overrideOO 
voidOO 
DownOO  $
(OO$ %
MigrationBuilderOO% 5
migrationBuilderOO6 F
)OOF G
{PP 	
migrationBuilderQQ 
.QQ 
	DropTableQQ &
(QQ& '
nameRR 
:RR 
$strRR #
)RR# $
;RR$ %
migrationBuilderTT 
.TT 
	DropTableTT &
(TT& '
nameUU 
:UU 
$strUU #
)UU# $
;UU$ %
migrationBuilderWW 
.WW 
	DropTableWW &
(WW& '
nameXX 
:XX 
$strXX  
)XX  !
;XX! "
}YY 	
}ZZ 
}[[ Õ
R/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Models/Cart.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )
Models) /
;/ 0
public 
class 
Cart 
{ 
public 


CartHeader 

CartHeader  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

IEnumerable 
< 
CartDetails "
>" #
CartDetails$ /
{0 1
get2 5
;5 6
set7 :
;: ;
}< =
} ˝
Y/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Models/CartDetails.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )
Models) /
;/ 0
public 
class 
CartDetails 
{ 
public 

int 
CartDetailsId 
{ 
get "
;" #
set$ '
;' (
}) *
public		 

int		 
CartHeaderId		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
[

 

ForeignKey

 
(

 
$str

 
)

 
]

  
public 

virtual 

CartHeader 

CartHeader (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 

int 
	ProductId 
{ 
get 
; 
set  #
;# $
}% &
[ 

ForeignKey 
( 
$str 
) 
] 
public 

virtual 
Product 
Product "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

int 
Count 
{ 
get 
; 
set 
;  
}! "
} ‡
X/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Models/CartHeader.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )
Models) /
;/ 0
public 
class 

CartHeader 
{ 
[ 
Key 
] 	
public 

int 
CartHeaderId 
{ 
get !
;! "
set# &
;& '
}( )
public

 

string

 
UserId

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
public 

string 

CouponCode 
{ 
get "
;" #
set$ '
;' (
}) *
} ·

`/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Models/Dto/CartDetailsDto.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )
Models) /
./ 0
Dto0 3
;3 4
public 
class 
CartDetailsDto 
{ 
public 

int 
CartDetailsId 
{ 
get "
;" #
set$ '
;' (
}) *
public		 

int		 
CartHeaderId		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
public

 

virtual

 
CartHeaderDto

  

CartHeader

! +
{

, -
get

. 1
;

1 2
set

3 6
;

6 7
}

8 9
public 

int 
	ProductId 
{ 
get 
; 
set  #
;# $
}% &
public 

virtual 

ProductDto 
Product %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 

int 
Count 
{ 
get 
; 
set 
;  
}! "
} ˝
Y/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Models/Dto/CartDto.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )
Models) /
./ 0
Dto0 3
;3 4
public 
class 
CartDto 
{ 
public 

CartHeaderDto 

CartHeader #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 

IEnumerable 
< 
CartDetailsDto %
>% &
CartDetails' 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
} €
_/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Models/Dto/CartHeaderDto.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )
Models) /
./ 0
Dto0 3
;3 4
public 
class 
CartHeaderDto 
{ 
public 

int 
CartHeaderId 
{ 
get !
;! "
set# &
;& '
}( )
public 

string 
UserId 
{ 
get 
; 
set  #
;# $
}% &
public		 

string		 

CouponCode		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
}

 ¶

\/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Models/Dto/ProductDto.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )
Models) /
./ 0
Dto0 3
;3 4
public 
class 

ProductDto 
{ 
public 

int 
	ProductId 
{ 
get 
; 
set  #
;# $
}% &
public		 

string		 
Name		 
{		 
get		 
;		 
set		 !
;		! "
}		# $
public

 

double

 
Price

 
{

 
get

 
;

 
set

 "
;

" #
}

$ %
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
CategoryName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

string 
ImageUrl 
{ 
get  
;  !
set" %
;% &
}' (
} ã	
]/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Models/Dto/ResponseDto.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )
Models) /
./ 0
Dto0 3
;3 4
public 
class 
ResponseDto 
{ 
public 

bool 
	IsSuccess 
{ 
get 
;  
set! $
;$ %
}& '
=( )
true* .
;. /
public 

object 
Result 
{ 
get 
; 
set  #
;# $
}% &
public 

string 
DisplayMessages !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
$str2 4
;4 5
public 

List 
< 
string 
> 
ErrorMessages %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
}		 Û
U/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Models/Product.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )
Models) /
;/ 0
public 
class 
Product 
{ 
[ 
Key 
, 	
DatabaseGenerated
 
( #
DatabaseGeneratedOption 3
.3 4
None4 8
)8 9
]9 :
public		 

int		 
	ProductId		 
{		 
get		 
;		 
set		  #
;		# $
}		% &
[

 
Required

 
]

 
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
[ 
Range 

(
 
$num 
, 
$num 
) 
] 
public 

double 
Price 
{ 
get 
; 
set "
;" #
}$ %
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
CategoryName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

string 
ImageUrl 
{ 
get  
;  !
set" %
;% &
}' (
} Ä6
N/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Program.cs
var		 
builder		 
=		 
WebApplication		 
.		 
CreateBuilder		 *
(		* +
args		+ /
)		/ 0
;		0 1
var 
connectionString 
= 
builder 
. 
Configuration ,
., -
GetConnectionString- @
(@ A
$strA T
)T U
;U V
builder 
. 
Services 
. 
AddDbContext 
<  
ApplicationDbContext 2
>2 3
(3 4
options4 ;
=>< >
options 
. 
UseSqlServer 
( 
connectionString )
)) *
)* +
;+ ,
IMapper 
mapper 
= 
MappingConfig 
. 
RegisterMap *
(* +
)+ ,
., -
CreateMapper- 9
(9 :
): ;
;; <
builder 
. 
Services 
. 
AddSingleton 
( 
mapper $
)$ %
;% &
builder 
. 
Services 
. 
AddAutoMapper 
( 
	AppDomain (
.( )
CurrentDomain) 6
.6 7
GetAssemblies7 D
(D E
)E F
)F G
;G H
builder 
. 
Services 
. 
	AddScoped 
< 
ICartRepository *
,* +
CartRepository, :
>: ;
(; <
)< =
;= >
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. 
AddAuthentication "
(" #
$str# +
)+ ,
. 
AddJwtBearer 
( 
$str 
, 
options #
=>$ &
{ 
if 

( 
builder 
. 
Environment 
.  
IsDevelopment  -
(- .
). /
)/ 0
{ 	
} 	
options   
.   
	Authority   
=   
$str   5
;  5 6
options!! 
.!! %
TokenValidationParameters!! )
=!!* +
new!!, /%
TokenValidationParameters!!0 I
{"" 	
ValidateAudience## 
=## 
false## $
}$$ 	
;$$	 

}%% 
)%% 
;%% 
builder'' 
.'' 
Services'' 
.'' 
AddAuthorization'' !
(''! "
options''" )
=>''* ,
{(( 
options)) 
.)) 
	AddPolicy)) 
()) 
$str))  
,))  !
policy))" (
=>))) +
{** 
policy++ 
.++ $
RequireAuthenticatedUser++ '
(++' (
)++( )
;++) *
policy,, 
.,, 
RequireClaim,, 
(,, 
$str,, #
,,,# $
$str,,% ,
),,, -
;,,- .
}-- 
)-- 
;-- 
}.. 
).. 
;.. 
builder11 
.11 
Services11 
.11 #
AddEndpointsApiExplorer11 (
(11( )
)11) *
;11* +
builder22 
.22 
Services22 
.22 
AddSwaggerGen22 
(22 
c22  
=>22! #
{33 
c44 
.44 

SwaggerDoc44 
(44 
$str44 
,44 
new44 
OpenApiInfo44 &
{44& '
Title44( -
=44. /
$str440 P
}44P Q
)44Q R
;44R S
c55 
.55 
EnableAnnotations55 
(55 
)55 
;55 
c66 
.66 !
AddSecurityDefinition66 
(66 
$str66 $
,66$ %
new66& )!
OpenApiSecurityScheme66* ?
{77 
Description88 
=88 
$str88 >
,88> ?
Name99 
=99 
$str99 
,99 
In:: 

=::
 
ParameterLocation:: 
.:: 
Header:: $
,::$ %
Type;; 
=;; 
SecuritySchemeType;; !
.;;! "
ApiKey;;" (
,;;( )
Scheme<< 
=<< 
$str<< 
}== 
)== 
;== 
c>> 
.>> "
AddSecurityRequirement>> 
(>> 
new>>  &
OpenApiSecurityRequirement>>! ;
{>>; <
{?? 	
new@@ !
OpenApiSecurityScheme@@ %
{AA 
	ReferenceBB 
=BB 
newBB 
OpenApiReferenceBB  0
{CC 
TypeDD 
=DD 
ReferenceTypeDD (
.DD( )
SecuritySchemeDD) 7
,DD7 8
IdEE 
=EE 
$strEE !
}FF 
,FF 
SchemeGG 
=GG 
$strGG !
,GG! "
NameHH 
=HH 
$strHH 
,HH  
InII 
=II 
ParameterLocationII &
.II& '
HeaderII' -
}JJ 
,JJ 
newKK 
ListKK 
<KK 
stringKK 
>KK 
(KK 
)KK 
}LL 	
}MM 
)MM 
;MM 
}NN 
)NN 
;NN 
varPP 
appPP 
=PP 	
builderPP
 
.PP 
BuildPP 
(PP 
)PP 
;PP 
ifSS 
(SS 
appSS 
.SS 
EnvironmentSS 
.SS 
IsDevelopmentSS !
(SS! "
)SS" #
)SS# $
{TT 
appUU 
.UU 

UseSwaggerUU 
(UU 
)UU 
;UU 
appVV 
.VV 
UseSwaggerUIVV 
(VV 
)VV 
;VV 
}WW 
appYY 
.YY 
UseHttpsRedirectionYY 
(YY 
)YY 
;YY 
appZZ 
.ZZ 
UseAuthenticationZZ 
(ZZ 
)ZZ 
;ZZ 
app[[ 
.[[ 
UseAuthorization[[ 
([[ 
)[[ 
;[[ 
app]] 
.]] 
MapControllers]] 
(]] 
)]] 
;]] 
app__ 
.__ 
Run__ 
(__ 
)__ 	
;__	 
ãb
`/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Repository/CartRepository.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )

Repository) 3
;3 4
public		 
class		 
CartRepository		 
:		 
ICartRepository		 ,
{

 
private 
readonly  
ApplicationDbContext )
_db* -
;- .
private 
IMapper 
_mapper 
; 
public 

CartRepository 
(  
ApplicationDbContext .
db/ 1
,1 2
IMapper3 :
mapper; A
)A B
{ 
_db 
= 
db 
; 
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
CartDto 
> 
GetCartByUserId .
(. /
string/ 5
userId6 <
)< =
{ 
Cart 
cart 
= 
new 
( 
) 
{ 	

CartHeader 
= 
await 
_db "
." #
CartHeaders# .
.. /
FirstOrDefaultAsync/ B
(B C
uC D
=>E G
uH I
.I J
UserIdJ P
==Q S
userIdT Z
)Z [
} 	
;	 

cart 
. 
CartDetails 
= 
_db 
. 
CartDetails *
. 
Where 
( 
u 
=> 
u 
. 
CartHeaderId &
==' )
cart* .
.. /

CartHeader/ 9
.9 :
CartHeaderId: F
)F G
.G H
IncludeH O
(O P
uP Q
=>Q S
uS T
.T U
ProductU \
)\ ]
;] ^
return 
_mapper 
. 
Map 
< 
CartDto "
>" #
(# $
cart$ (
)( )
;) *
} 
public!! 

async!! 
Task!! 
<!! 
CartDto!! 
>!! 
CreateUpdateCart!! /
(!!/ 0
CartDto!!0 7
cartDto!!8 ?
)!!? @
{"" 
Cart## 
cart## 
=## 
_mapper## 
.## 
Map## 
<##  
Cart##  $
>##$ %
(##% &
cartDto##& -
)##- .
;##. /
var%% 
prodInDb%% 
=%% 
_db%% 
.%% 
Products%% #
.%%# $
FirstOrDefault%%$ 2
(%%2 3
u&& 
=>&& 
u&& 
.&& 
	ProductId&& 
==&& 
cartDto&&  '
.&&' (
CartDetails&&( 3
.&&3 4
FirstOrDefault&&4 B
(&&B C
)&&C D
.&&D E
	ProductId&&E N
)'' 	
;''	 

if)) 

()) 
prodInDb)) 
==)) 
null)) 
))) 
{** 	
_db++ 
.++ 
Products++ 
.++ 
Add++ 
(++ 
cart++ !
.++! "
CartDetails++" -
.++- .
FirstOrDefault++. <
(++< =
)++= >
.++> ?
Product++? F
)++F G
;++G H
await,, 
_db,, 
.,, 
SaveChangesAsync,, &
(,,& '
),,' (
;,,( )
}-- 	
var// 
cartHeaderFromDb// 
=// 
_db// "
.//" #
CartHeaders//# .
.//. /
AsNoTracking/// ;
(//; <
)//< =
.00 
FirstOrDefault00 
(00 
u00 
=>00 
u00  
.00  !
UserId00! '
==00( *
cart00+ /
.00/ 0

CartHeader000 :
.00: ;
UserId00; A
)00A B
;00B C
if22 

(22 
cartHeaderFromDb22 
==22 
null22  $
)22$ %
{33 	
_db44 
.44 
CartHeaders44 
.44 
Add44 
(44  
cart44  $
.44$ %

CartHeader44% /
)44/ 0
;440 1
await55 
_db55 
.55 
SaveChangesAsync55 &
(55& '
)55' (
;55( )
cart66 
.66 
CartDetails66 
.66 
FirstOrDefault66 +
(66+ ,
)66, -
.66- .
CartHeaderId66. :
=66; <
cart66= A
.66A B

CartHeader66B L
.66L M
CartHeaderId66M Y
;66Y Z
cart77 
.77 
CartDetails77 
.77 
FirstOrDefault77 +
(77+ ,
)77, -
.77- .
Product77. 5
=776 7
null778 <
;77< =
_db88 
.88 
CartDetails88 
.88 
Add88 
(88  
cart88  $
.88$ %
CartDetails88% 0
.880 1
FirstOrDefault881 ?
(88? @
)88@ A
)88A B
;88B C
await99 
_db99 
.99 
SaveChangesAsync99 &
(99& '
)99' (
;99( )
}:: 	
else;; 
{<< 	
var== 
cartDetailsFromDb== !
===" #
_db==$ '
.==' (
CartDetails==( 3
.==3 4
AsNoTracking==4 @
(==@ A
)==A B
.==B C
FirstOrDefault==C Q
(==Q R
u>> 
=>>> 
u>> 
.>> 
	ProductId>>  
==>>! #
cart>>$ (
.>>( )
CartDetails>>) 4
.>>4 5
FirstOrDefault>>5 C
(>>C D
)>>D E
.>>E F
	ProductId>>F O
&&>>P R
u?? 
.?? 
CartHeaderId?? #
==??$ &
cartHeaderFromDb??' 7
.??7 8
CartHeaderId??8 D
)??D E
;??E F
ifAA 
(AA 
cartDetailsFromDbAA !
==AA" $
nullAA% )
)AA) *
{BB 
cartCC 
.CC 
CartDetailsCC  
.CC  !
FirstOrDefaultCC! /
(CC/ 0
)CC0 1
.CC1 2
CartHeaderIdCC2 >
=CC? @
cartHeaderFromDbCCA Q
.CCQ R
CartHeaderIdCCR ^
;CC^ _
cartDD 
.DD 
CartDetailsDD  
.DD  !
FirstOrDefaultDD! /
(DD/ 0
)DD0 1
.DD1 2
ProductDD2 9
=DD: ;
nullDD< @
;DD@ A
_dbEE 
.EE 
CartDetailsEE 
.EE  
AddEE  #
(EE# $
cartEE$ (
.EE( )
CartDetailsEE) 4
.EE4 5
FirstOrDefaultEE5 C
(EEC D
)EED E
)EEE F
;EEF G
awaitFF 
_dbFF 
.FF 
SaveChangesAsyncFF *
(FF* +
)FF+ ,
;FF, -
}GG 
elseHH 
{II 
cartJJ 
.JJ 
CartDetailsJJ  
.JJ  !
FirstOrDefaultJJ! /
(JJ/ 0
)JJ0 1
.JJ1 2
ProductJJ2 9
=JJ: ;
nullJJ< @
;JJ@ A
cartKK 
.KK 
CartDetailsKK  
.KK  !
FirstOrDefaultKK! /
(KK/ 0
)KK0 1
.KK1 2
CountKK2 7
+=KK8 :
cartDetailsFromDbKK; L
.KKL M
CountKKM R
;KKR S
_dbLL 
.LL 
CartDetailsLL 
.LL  
UpdateLL  &
(LL& '
cartLL' +
.LL+ ,
CartDetailsLL, 7
.LL7 8
FirstOrDefaultLL8 F
(LLF G
)LLG H
)LLH I
;LLI J
awaitMM 
_dbMM 
.MM 
SaveChangesAsyncMM *
(MM* +
)MM+ ,
;MM, -
}NN 
}OO 	
returnPP 
_mapperPP 
.PP 
MapPP 
<PP 
CartDtoPP "
>PP" #
(PP# $
cartPP$ (
)PP( )
;PP) *
}QQ 
publicSS 

asyncSS 
TaskSS 
<SS 
boolSS 
>SS 
RemoveFromCartSS *
(SS* +
intSS+ .
cartDetailsIdSS/ <
)SS< =
{TT 
tryUU 
{VV 	
CartDetailsWW 
cartDetailsWW #
=WW$ %
awaitWW& +
_dbWW, /
.WW/ 0
CartDetailsWW0 ;
.WW; <
FirstOrDefaultAsyncWW< O
(WWO P
uWWP Q
=>WWR T
uWWU V
.WWV W
CartDetailsIdWWW d
==WWe g
cartDetailsIdWWh u
)WWu v
;WWv w
intYY !
totalCountOfCartItemsYY %
=YY& '
_dbYY( +
.YY+ ,
CartDetailsYY, 7
.YY7 8
WhereYY8 =
(YY= >
uYY> ?
=>YY@ B
uYYC D
.YYD E
CartHeaderIdYYE Q
==YYR T
cartDetailsYYU `
.YY` a
CartHeaderIdYYa m
)YYm n
.YYn o
CountYYo t
(YYt u
)YYu v
;YYv w
_db[[ 
.[[ 
CartDetails[[ 
.[[ 
Remove[[ "
([[" #
cartDetails[[# .
)[[. /
;[[/ 0
if\\ 
(\\ !
totalCountOfCartItems\\ %
==\\& (
$num\\) *
)\\* +
{]] 
var^^ 
cartHeaderToRemove^^ &
=^^' (
await__ 
_db__ 
.__ 
CartHeaders__ )
.`` 
FirstOrDefaultAsync`` ,
(``, -
u``- .
=>``/ 1
u``2 3
.``3 4
CartHeaderId``4 @
==``A C
cartDetails``D O
.``O P
CartHeaderId``P \
)``\ ]
;``] ^
_dbbb 
.bb 
CartHeadersbb 
.bb  
Removebb  &
(bb& '
cartHeaderToRemovebb' 9
)bb9 :
;bb: ;
}cc 
awaitee 
_dbee 
.ee 
SaveChangesAsyncee &
(ee& '
)ee' (
;ee( )
returnff 
trueff 
;ff 
}gg 	
catchhh 
(hh 
	Exceptionhh 
ehh 
)hh 
{ii 	
Consolejj 
.jj 
	WriteLinejj 
(jj 
ejj 
)jj  
;jj  !
returnkk 
falsekk 
;kk 
}ll 	
}mm 
publicoo 

asyncoo 
Taskoo 
<oo 
booloo 
>oo 
	ClearCartoo %
(oo% &
stringoo& ,
userIdoo- 3
)oo3 4
{pp 
varqq 
cartHeaderFromDbqq 
=qq 
awaitqq $
_dbqq% (
.qq( )
CartHeadersqq) 4
.qq4 5
FirstOrDefaultAsyncqq5 H
(qqH I
uqqI J
=>qqK M
uqqN O
.qqO P
UserIdqqP V
==qqW Y
userIdqqZ `
)qq` a
;qqa b
ifrr 

(rr 
cartHeaderFromDbrr 
!=rr 
nullrr  $
)rr$ %
{ss 	
_dbtt 
.tt 
CartDetailstt 
.tt 
RemoveRangett '
(tt' (
_dbtt( +
.tt+ ,
CartDetailstt, 7
.tt7 8
Wherett8 =
(tt= >
utt> ?
=>tt? A
uttA B
.ttB C
CartHeaderIdttC O
==ttP R
cartHeaderFromDbttS c
.ttc d
CartHeaderIdttd p
)ttp q
)ttq r
;ttr s
_dbuu 
.uu 
CartHeadersuu 
.uu 
Removeuu "
(uu" #
cartHeaderFromDbuu# 3
)uu3 4
;uu4 5
awaitvv 
_dbvv 
.vv 
SaveChangesAsyncvv &
(vv& '
)vv' (
;vv( )
returnww 
trueww 
;ww 
}xx 	
returnyy 
falseyy 
;yy 
}zz 
}{{ »
a/home/manuel/sources/MangoRestaurant/Mango.Services.ShoppingCartAPI/Repository/ICartRepository.cs
	namespace 	
Mango
 
. 
Services 
. 
ShoppingCartAPI (
.( )

Repository) 3
;3 4
public 
	interface 
ICartRepository  
{ 
Task 
< 	
CartDto	 
> 
GetCartByUserId !
(! "
string" (
userId) /
)/ 0
;0 1
Task 
< 	
CartDto	 
> 
CreateUpdateCart "
(" #
CartDto# *
cartDto+ 2
)2 3
;3 4
Task		 
<		 	
bool			 
>		 
RemoveFromCart		 
(		 
int		 !
cartDetailsId		" /
)		/ 0
;		0 1
Task

 
<

 	
bool

	 
>

 
	ClearCart

 
(

 
string

 
userId

  &
)

& '
;

' (
} 